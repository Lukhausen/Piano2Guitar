var e=class{constructor(e,t,s,o,i,n){this.idCounter=0,this.items=e,this.dropzoneId=t,this.emptyMessageContainer=document.getElementById(n),this.itemsContainer=document.getElementById(s),this.selectedItemsContainer=document.getElementById(i),this.itemFilterInput=document.getElementById(o),this.displayArray=document.createElement("div"),this.displayArray.id="displayArray",document.body.appendChild(this.displayArray),this.selectedItemsArray=[],this.addEventListeners(),this.populateItemsList(),this.emptyMessage="Click on chords to add",this.emptyMessageElement=document.createElement("div"),this.emptyMessageElement.id="DragAndDrop-EmptyMessage";let a=this.emptyMessage.split(" "),r=this.createItemElement("Sample Word");r.draggable=!1,r.isSelectable=!1,a.forEach(e=>{let t=r.cloneNode(!0);t.innerHTML=e,this.emptyMessageElement.appendChild(t)}),this.selectedItemsContainer.appendChild(this.emptyMessageElement)}addEventListeners(){window.addEventListener("dragover",this.handleWindowDragOver.bind(this)),window.addEventListener("drop",this.handleWindowDrop.bind(this)),this.selectedItemsContainer.addEventListener("dragover",this.allowDrop.bind(this)),this.selectedItemsContainer.addEventListener("drop",this.handleDropOnContainer.bind(this)),this.itemFilterInput.addEventListener("input",this.filterItems.bind(this))}handleWindowDragOver(e){(e=e||event).target.id!==this.dropzoneId&&e.preventDefault()}handleWindowDrop(e){(e=e||event).target.id!==this.dropzoneId&&e.preventDefault()}populateItemsList(){this.items.forEach(e=>{this.itemsContainer.appendChild(this.createItemElement(e,!0))})}createItemElement(e,t=!1){let s=document.createElement("div");if(s.textContent=e.name,s.className="dragDropItem",s.id=`dragDropItem-${this.idCounter++}`,void 0!==e.probability){let t=document.createElement("span");t.textContent=`(${e.probability}%)`,t.style.backgroundColor=this.getBackgroundColor(e.probability),100==e.probability&&(s.style.boxShadow="0px 0px 10px 0px rgba(255,200,0)"),s.appendChild(t)}return t&&s.addEventListener("click",()=>this.addSelectedItem(e)),s}getBackgroundColor(e){let t=[63,243,51],s=Math.log10(1+((e=Math.max(50,Math.min(100,e)))-50)/50*9),o=[221,221,221].map((e,o)=>Math.round(e+(t[o]-e)*s));return 100==e&&(o=[255,200,0]),`rgb(${o.join(",")})`}createSelectedItemElement(e){let t=document.createElement("div");return t.className="selected-dragDropItem dragDropItem",t.draggable=!0,t.id=`selected-dragDropItem-${this.idCounter++}`,t.textContent=e.name,t.addEventListener("dragstart",this.handleDragStart.bind(this)),t.addEventListener("dragover",this.handleDragOver.bind(this)),t.addEventListener("drop",this.handleDropReorder.bind(this)),t.addEventListener("dragend",this.handleDragEnd.bind(this)),t.addEventListener("dragleave",this.handleDragLeave.bind(this)),t.addEventListener("click",this.removeSelectedItem.bind(this)),t}removeSelectedItem(e){e.target.remove(),this.updateArray()}addSelectedItem(e){let t=this.createSelectedItemElement(e);this.selectedItemsContainer.appendChild(t),this.selectedItemsArray.push(e.name),this.updateDisplayArray()}ceateAndInsertElement(e){let t=this.createSelectedItemElement(e);this.addSelectedItem(t)}updateItems(e){console.log("Updating Library..."),this.clearList(),this.items=e,this.populateItemsList()}clearList(){for(this.items=[];this.itemsContainer.firstChild;)this.itemsContainer.removeChild(this.itemsContainer.firstChild)}handleDropOnItemList(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain"),s=document.getElementById(t);s&&s.classList.contains("selected-dragDropItem")&&(s.remove(),this.updateArray())}handleDragStart(e){e.dataTransfer.setData("text/plain",e.target.id),e.target.classList.contains("selected-dragDropItem")&&e.target.classList.add("dragging")}handleDragOver(e){e.preventDefault();let t=e.target.closest(".selected-dragDropItem");t&&t.classList.add("over")}handleDragLeave(e){e.preventDefault();let t=e.target.closest(".selected-dragDropItem");t&&t.classList.remove("over")}handleDropReorder(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain"),s=document.getElementById(t);if(!s)return;let o=e.target.closest(".selected-dragDropItem");if(o)s.classList.contains("selected-dragDropItem")&&this.insertAtCorrectPosition(s,o);else if(s.classList.contains("selected-dragDropItem"))this.selectedItemsContainer.appendChild(s);else{let e=this.createSelectedItemElement(s.textContent);this.selectedItemsContainer.appendChild(e),this.selectedItemsArray.push(s.textContent)}this.updateDisplayArray()}handleDragEnd(e){e.target.classList.remove("dragging"),document.querySelectorAll(".selected-dragDropItem").forEach(e=>e.classList.remove("over"))}allowDrop(e){e.preventDefault()}handleDropOnContainer(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain"),s=document.getElementById(t);if(s&&!s.classList.contains("selected-dragDropItem")){let e={name:s.textContent,probability:void 0},t=this.createSelectedItemElement(e);this.selectedItemsContainer.appendChild(t),this.selectedItemsArray.push(e.name),this.updateDisplayArray()}}insertAtCorrectPosition(e,t){Array.from(this.selectedItemsContainer.children).indexOf(e)<Array.from(this.selectedItemsContainer.children).indexOf(t)?t.after(e):t.before(e),t.classList.remove("over"),this.updateArray()}updateArray(){this.selectedItemsArray=Array.from(this.selectedItemsContainer.children).map(e=>e.textContent),this.updateDisplayArray()}updateDisplayArray(){this.displayArray.textContent=`Selected Items: ${this.selectedItemsArray.join(", ")}`,console.log(this.selectedItemsArray.length),0==this.selectedItemsArray.length?this.emptyMessageElement.parentNode||this.selectedItemsContainer.appendChild(this.emptyMessageElement):this.emptyMessageElement.remove()}filterItems(){let e=this.itemFilterInput.value.toUpperCase();this.itemsContainer.querySelectorAll(".dragDropItem").forEach(t=>{let s=t.textContent.toUpperCase();t.style.display=s.includes(e)?"":"none"})}getArray(){return[...this.selectedItemsArray]}},t=class{constructor(e,t={}){this.container=document.querySelector(e),this.updatePlayedNotesDebounced=this.debounce(this.updatePlayedNotes,10),this.octaves=t.octaves||2,this.playedNotes=[],this.rootNote=null,this.layout=[0,1,0,1,0,0,1,0,1,0,1,0],this.keysPerOctave=this.layout.length,this.whiteKeyCount=this.layout.filter(e=>0===e).length,this.whiteKeyWidth=100/(this.whiteKeyCount*this.octaves),this.blackKeyWidth=.5829787234*this.whiteKeyWidth,this.blackKeyHeight=.63,this.totalKeys=this.octaves*this.keysPerOctave,this.createPiano(),this.addKeyListeners()}createPiano(){this.container.innerHTML="";let e=0;for(let t=0;t<this.totalKeys;t++){let s=document.createElement("div");s.setAttribute("data-note",t),1===this.layout[t%this.keysPerOctave]?(s.classList.add("key","black"),s.style.left=`${e*this.whiteKeyWidth-this.blackKeyWidth/2}%`,s.style.width=`${this.blackKeyWidth}%`,s.style.height=`${100*this.blackKeyHeight}%`,s.style.boxSizing="border-box",s.style.position="absolute"):(s.classList.add("key","white"),s.style.boxSizing="border-box",s.style.width=`${this.whiteKeyWidth}%`,e++),this.container.appendChild(s)}}addKeyListeners(){this.container.querySelectorAll(".key").forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("data-note");this.rootNote!==t?(this.playedNotes.includes(t)?(this.playedNotes=this.playedNotes.filter(e=>e!==t),e.classList.remove("selectedKey")):(this.playedNotes.push(t),e.classList.add("selectedKey")),this.updatePlayedNotesDebounced()):this.setRootNote(t)}),e.addEventListener("dblclick",t=>{t.stopPropagation();let s=e.getAttribute("data-note");this.setRootNote(s)})})}debounce(e,t){let s;return function(...o){clearTimeout(s),s=setTimeout(()=>{e.apply(this,o)},t)}}setRootNote(e){this.rootNote===e?(this.rootNote=null,this.container.querySelector(`.key[data-note="${e}"]`).classList.remove("rootNote")):(null!==this.rootNote&&this.container.querySelector(`.key[data-note="${this.rootNote}"]`).classList.remove("rootNote"),this.rootNote=e,this.playedNotes.includes(e)||this.playedNotes.push(e),this.container.querySelector(`.key[data-note="${e}"]`).classList.add("rootNote"),this.container.querySelector(`.key[data-note="${e}"]`).classList.add("selectedKey")),this.updatePlayedNotesDebounced()}updatePlayedNotes(){let e=new CustomEvent("notesChanged",{detail:{notes:this.playedNotes,rootNote:this.rootNote}});console.log("Dispatching Note Change Event: "+this.playedNotes+" Root: "+this.rootNote),this.container.dispatchEvent(e)}clearPiano(){this.playedNotes=[],this.rootNote=null,this.container.querySelectorAll(".key.selectedKey").forEach(e=>{e.classList.remove("selectedKey")}),this.container.querySelectorAll(".key.rootNote").forEach(e=>{e.classList.remove("rootNote")}),this.updatePlayedNotes()}setOctaves(e){e!==this.octaves&&(this.octaves=e,this.totalKeys=this.octaves*this.keysPerOctave,this.whiteKeyWidth=100/(this.whiteKeyCount*this.octaves),this.blackKeyWidth=.5829787234*this.whiteKeyWidth,this.clearPiano(),this.createPiano(),this.addKeyListeners())}};class s{constructor(e,t,s,o){this.rootNote=e,this.notes=t,this.name=s,this.customRoot=o,console.log("Registered Note: "+this.name+" Root: "+this.rootNote+" Notes: "+this.notes)}}class o{constructor(){this.chords=[],this.noteNames=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this.chordStructures={"":{notes:[0,4,7]},m:{notes:[0,3,7]},7:{notes:[0,4,7,10]},M7:{notes:[0,4,7,11]},m7:{notes:[0,3,7,10]},mM7:{notes:[0,3,7,11]},sus2:{notes:[0,2,7]},sus4:{notes:[0,5,7]},dim:{notes:[0,3,6]},aug:{notes:[0,4,8]},9:{notes:[0,4,7,10,14]},M9:{notes:[0,4,7,11,14]},m9:{notes:[0,3,7,10,14]},11:{notes:[0,4,7,10,14,17]},13:{notes:[0,4,7,10,14,17,21]},add9:{notes:[0,2,4,7]},m6:{notes:[0,3,7,9]},6:{notes:[0,4,7,9]},5:{notes:[0,7]},"6/9":{notes:[0,4,7,9,14]},m11:{notes:[0,3,7,10,17]},"M7#11":{notes:[0,4,7,11,18]},m7b5:{notes:[0,3,6,10]},"/C":{notes:[0,4,7],root:0},"/Cm":{notes:[0,3,7],root:0},"/C#":{notes:[0,4,7],root:1},"/C#m":{notes:[0,3,7],root:1},"/D":{notes:[0,4,7],root:2},"/Dm":{notes:[0,3,7],root:2},"/D#":{notes:[0,4,7],root:3},"/D#m":{notes:[0,3,7],root:3},"/E":{notes:[0,4,7],root:4},"/Em":{notes:[0,3,7],root:4},"/F":{notes:[0,4,7],root:5},"/Fm":{notes:[0,3,7],root:5},"/F#":{notes:[0,4,7],root:6},"/F#m":{notes:[0,3,7],root:6},"/G":{notes:[0,4,7],root:7},"/Gm":{notes:[0,3,7],root:7},"/G#":{notes:[0,4,7],root:8},"/G#m":{notes:[0,3,7],root:8},"/A":{notes:[0,4,7],root:9},"/Am":{notes:[0,3,7],root:9},"/A#":{notes:[0,4,7],root:10},"/A#m":{notes:[0,3,7],root:10},"/B":{notes:[0,4,7],root:11},"/Bm":{notes:[0,3,7],root:11}},this.generateChords()}generateChords(){Object.entries(this.chordStructures).forEach(([e,t])=>{for(let o=0;o<12;o++){let i=o,n=!1,a=t.notes.map(e=>(o+e)%12),r=`${this.noteNames[o]}${e}`;if(void 0!==t.root){if(t.root==i)continue;i=t.root,n=!0,a.push(i)}this.chords.push(new s(i,a,r,n))}})}searchChords(e,t,s=50){console.log("Searching Chords...");let o=[];return e=e.map(e=>e%12),t&&(t%=12),this.chords.forEach(i=>{let n=[...i.notes];console.log("Comparing to: "+i.name);let a=new Set(e);console.log("Input Notes Set: ",a);let r=new Set([...n].filter(e=>a.has(e)));console.log("Common Notes with Chord: ",r);let d=new Set([...n,...e]);console.log("Total Unique Notes: ",d);let l=r.size/d.size*100;console.log("Searched Root: "+t+" Presen Root: "+i.rootNote),null!==t?i.rootNote==t?console.log("Matching Root for: "+i.name+" Root: "+i.rootNote+" Notes: "+n):(l*=.85,console.log("Panelized for not matching Root")):!0==i.customRoot&&(l*=.85,console.log("Panelized For Havinng Specific when it shouldnt")),l>=s&&o.push({name:i.name,probability:parseFloat(l.toFixed(2))})}),o.sort((e,t)=>t.probability-e.probability)}getAllChords(){return this.chords.map(e=>({name:e.name}))}getChordByName(e){let t=this.chords.find(t=>t.name===e);return t?(console.log("Chord found:",t),t):(console.log("No chord found with the name:",e),null)}}document.addEventListener("DOMContentLoaded",()=>{function s(){let e=window.innerWidth;return console.log(Math.sqrt(e)),Math.min(3,Math.ceil(Math.sqrt(e)/25))}let i=new t(".pianoContainer",{octaves:s()}),n=new o,a=n.getAllChords(),r=new e(a,"selectedItems","itemsContainer","itemSearch","selectedItems","emptyMessageContainer");window.clearPiano=function(){document.getElementById("itemSearch").value="",i.clearPiano(),console.log("Piano cleared")},window.onresize=function(){let e=s();i.setOctaves(e)},document.querySelector(".pianoContainer").addEventListener("notesChanged",e=>{let t;console.log("Piano notes changed:",e.detail.notes,e.detail.rootNote),e.detail.notes.length>0?(console.log("Reviced notesChanged Event: "+e.detail.notes+" Root: "+e.detail.rootNote),t=n.searchChords(e.detail.notes,e.detail.rootNote,50)):t=a,r.updateItems(t)})});
//# sourceMappingURL=index.84e6249a.js.map
